/*!
 * (C) BKKR Framework https://bkkr-team.github.io/bkkr-docs/ - MIT License
 */
import{b as t}from"./p-e7c3cb65.js";import{O as e}from"./p-c60e44a7.js";import{c as o,f as n,a as r,b as a,g as s}from"./p-6518e4d1.js";let i=0;const d=new WeakMap,c=t=>({create:e=>y(t,e),dismiss:(e,o,n)=>g(document,e,o,t,n),getTop:async()=>B(document,t)}),k=c("bkkr-alert"),l=c("bkkr-drawer"),b=c("bkkr-loading"),u=c("bkkr-modal"),p=c("bkkr-popover"),v=c("bkkr-toast"),m=(t,e={trapKeyboardFocus:!0})=>{"undefined"!=typeof document&&j(document,e);const o=i++;t.overlayIndex=o,t.hasAttribute("id")||(t.id=`bkkr-overlay-${o}`)},y=(t,e)=>"undefined"!=typeof window&&void 0!==window.customElements?window.customElements.whenDefined(t).then((()=>{const n=document.createElement(t);return n.classList.add("overlay-hidden"),Object.assign(n,Object.assign(Object.assign({},e),{hasController:!0})),T(document).appendChild(n),new Promise((t=>o(n,t)))})):Promise.resolve(),f='[tabindex]:not([tabindex^="-"]), input:not([type=hidden]):not([tabindex^="-"]), textarea:not([tabindex^="-"]), button:not([tabindex^="-"]), select:not([tabindex^="-"]), .state-focusable:not([tabindex^="-"])',w="input:not([type=hidden]), textarea, button, select",x=(t,e)=>{let o=t.querySelector(f);const r=o&&o.shadowRoot;r&&(o=r.querySelector(w)||o),o?n(o):e.focus()},h=(t,e)=>{const o=Array.from(t.querySelectorAll(f));let n=o.length>0?o[o.length-1]:null;const r=n&&n.shadowRoot;r&&(n=r.querySelector(w)||n),n?n.focus():e.focus()},j=(t,o)=>{0===i&&(i=1,o.trapKeyboardFocus&&t.addEventListener("focus",(e=>{e.target&&"BKKR-MENU"===e.target.tagName||((t,e)=>{const o=B(e),n=t.target;o&&n&&(o.shadowRoot?(()=>{if(o.contains(n))o.lastFocus=n;else{const t=o.lastFocus;x(o,o),t===e.activeElement&&h(o,o),o.lastFocus=e.activeElement}})():(()=>{if(o===n)o.lastFocus=void 0;else{const t=s(o);if(!t.contains(n))return;const r=t.querySelector(".bkkr-overlay-wrapper");if(!r)return;if(r.contains(n))o.lastFocus=n;else{const t=o.lastFocus;x(r,o),t===e.activeElement&&h(r,o),o.lastFocus=e.activeElement}}})())})(e,t)}),!0),t.addEventListener("bkkrBackButton",(o=>{const n=B(t);n&&n.backdropDismiss&&o.detail.register(e,(()=>n.dismiss(void 0,F)))})),t.addEventListener("keyup",(e=>{if("Escape"===e.key){const e=B(t);e&&e.backdropDismiss&&e.dismiss(void 0,F)}})))},g=(t,e,o,n,r)=>{const a=B(t,n,r);return a?a.dismiss(e,o):Promise.reject("overlay does not exist")},B=(t,e,o)=>{const n=((t,e)=>(void 0===e&&(e="bkkr-alert,bkkr-drawer,bkkr-loading,bkkr-modal,bkkr-popover,bkkr-toast"),Array.from(t.querySelectorAll(e)).filter((t=>t.overlayIndex>0))))(t,e).filter((t=>!t.classList.contains("overlay-hidden")));return void 0===o?n[n.length-1]:n.find((t=>t.id===o))},K=(t=!1)=>{const e=T(document).querySelector("bkkr-router-outlet, bkkr-nav, #bkkr-view-container-root");e&&(t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden"))},O=async(e,o,n,r)=>{var a,s;if(e.presented)return;K(!0),e.presented=!0,e.willPresent.emit(),null===(a=e.willPresentShorthand)||void 0===a||a.emit();const i=e.enterAnimation?e.enterAnimation:t.get(o,n);await E(e,i,e.el,r)&&(e.didPresent.emit(),null===(s=e.didPresentShorthand)||void 0===s||s.emit()),"BKKR-TOAST"!==e.el.tagName&&P(e.el),e.keyboardClose&&e.el.focus()},P=async t=>{let e=document.activeElement;if(!e)return;const o=e&&e.shadowRoot;o&&(e=o.querySelector(w)||e),await t.onDidDismiss(),e.focus()},A=async(e,o,n,r,a,s)=>{var i,c;if(!e.presented)return!1;K(!1),e.presented=!1;try{e.el.style.setProperty("pointer-events","none"),e.willDismiss.emit({data:o,role:n}),null===(i=e.willDismissShorthand)||void 0===i||i.emit({data:o,role:n});const k=e.leaveAnimation?e.leaveAnimation:t.get(r,a);"gesture"!==n&&await E(e,k,e.el,s),e.didDismiss.emit({data:o,role:n}),null===(c=e.didDismissShorthand)||void 0===c||c.emit({data:o,role:n}),d.delete(e),e.el.classList.add("overlay-hidden"),e.el.style.removeProperty("pointer-events")}catch(t){console.error(t)}return e.el.remove(),!0},T=t=>t.querySelector("bkkr-root")||t.body,E=async(e,o,n,r)=>{n.classList.remove("overlay-hidden");const a=o(e.el,r);e.animated&&t.getBoolean("animated",!0)||a.duration(0),e.keyboardClose&&a.beforeAddWrite((()=>{const t=n.ownerDocument.activeElement;t&&t.matches("input,bkkr-input, bkkr-datepicker, bkkr-textarea")&&t.blur()}));const s=d.get(e)||[];return d.set(e,[...s,a]),await a.play(),!0},M=(t,e)=>{let o;const n=new Promise((t=>o=t));return R(t,e,(t=>{o(t.detail)})),n},R=(t,e,o)=>{const n=r=>{a(t,e,n),o(r)};r(t,e,n)},C=t=>"cancel"===t||t===F,F="backdrop";export{F as B,k as a,m as b,O as c,l as d,A as e,M as f,d as g,B as h,C as i,x as j,b as l,u as m,p,v as t}