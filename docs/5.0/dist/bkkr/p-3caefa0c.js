import{a as t,r as e,g as n}from"./p-812c3cb0.js";let o=0;const a=new WeakMap,r=t=>({create:e=>u(t,e),dismiss:(e,n,o)=>p(document,e,n,t,o),getTop:async()=>m(document,t)}),s=r("bkkr-alert"),c=r("bkkr-drawer"),i=r("bkkr-popover"),d=t=>{"undefined"!=typeof document&&l(document);const e=o++;t.overlayIndex=e,t.hasAttribute("id")||(t.id="bkkr-overlay-"+e)},u=(t,e)=>"undefined"!=typeof customElements?customElements.whenDefined(t).then((()=>{const n=document.createElement(t);return n.classList.add("overlay-hidden"),Object.assign(n,e),v(document).appendChild(n),n.componentOnReady()})):Promise.resolve(),b='[tabindex]:not([tabindex^="-"]), input:not([type=hidden]):not([tabindex^="-"]), textarea:not([tabindex^="-"]), button:not([tabindex^="-"]), select:not([tabindex^="-"]), .bkkr-focusable:not([tabindex^="-"])',k="input:not([type=hidden]), textarea, button, select",l=t=>{0===o&&(o=1,t.addEventListener("focus",(e=>((t,e)=>{const o=m(e),a=t.target;if(o&&a)if(o===a)o.lastFocus=void 0;else{const t=n(o);if(!t.contains(a))return;const r=t.querySelector(".bkkr-overlay-wrapper");if(!r)return;if(r.contains(a))o.lastFocus=a;else{const t=o.lastFocus;((t,e)=>{let n=t.querySelector(b);const o=n&&n.shadowRoot;o&&(n=o.querySelector(k)||n),n?n.focus():e.focus()})(r,o),t===e.activeElement&&((t,e)=>{const n=Array.from(t.querySelectorAll(b));let o=n.length>0?n[n.length-1]:null;const a=o&&o.shadowRoot;a&&(o=a.querySelector(k)||o),o?o.focus():e.focus()})(r,o),o.lastFocus=e.activeElement}}})(e,t)),!0),t.addEventListener("keyup",(e=>{if("Escape"===e.key){const e=m(t);e&&e.backdropDismiss&&e.dismiss(void 0,E)}})))},p=(t,e,n,o,a)=>{const r=m(t,o,a);return r?r.dismiss(e,n):Promise.reject("overlay does not exist")},m=(t,e,n)=>{const o=((t,e)=>(void 0===e&&(e="bkkr-modal,bkkr-toast"),Array.from(t.querySelectorAll(e)).filter((t=>t.overlayIndex>0))))(t,e);return void 0===n?o[o.length-1]:o.find((t=>t.id===n))},y=async(t,e,n)=>{if(t.presented)return;t.presented=!0,t.willPresent.emit();const o=t.enterAnimation?t.enterAnimation:e;await w(t,o,t.el,n)&&t.didPresent.emit(),"BKKR-TOAST"!==t.el.tagName&&f(t.el),t.keyboardClose&&t.el.focus()},f=async t=>{let e=document.activeElement;if(!e)return;const n=e&&e.shadowRoot;n&&(e=n.querySelector(k)||e),await t.onDidDismiss(),e.focus()},x=async(t,e,n,o,r)=>{if(!t.presented)return!1;t.presented=!1;try{t.el.style.setProperty("pointer-events","none"),t.willDismiss.emit({data:e,role:n});const s=t.leaveAnimation?t.leaveAnimation:o;"gesture"!==n&&await w(t,s,t.el,r),t.didDismiss.emit({data:e,role:n}),a.delete(t)}catch(t){console.error(t)}return t.el.remove(),!0},v=t=>t.querySelector("bkkr-app")||t.body,w=async(t,e,n,o)=>{n.classList.remove("overlay-hidden");const r=e(n.shadowRoot||t.el,o);t.animated||r.duration(0),t.keyboardClose&&r.beforeAddWrite((()=>{const t=n.ownerDocument.activeElement;t&&t.matches("input, bkkr-input, bkkr-textarea")&&t.blur()}));const s=a.get(t)||[];return a.set(t,[...s,r]),await r.play(),!0},h=(t,e)=>{let n;const o=new Promise((t=>n=t));return g(t,e,(t=>{n(t.detail)})),o},g=(n,o,a)=>{const r=t=>{e(n,o,r),a(t)};t(n,o,r)},A=t=>"cancel"===t||t===E,E="backdrop";export{E as B,y as a,a as b,i as c,x as d,h as e,c as f,s as g,A as i,d as p}